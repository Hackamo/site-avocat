<div class="blog-admin-container">
	<div class="admin-header">
		<h1>Gestion des Articles du Blog</h1>
		<button (click)="toggleForm()" class="btn btn-primary">
			{{ showForm() ? 'Annuler' : 'Créer un nouvel article' }}
		</button>
	</div>

	@if (message()) {
	<div
		class="alert"
		[class.alert-success]="messageType() === 'success'"
		[class.alert-error]="messageType() === 'error'"
	>
		{{ message() }}
	</div>
	} @if (showForm()) {
	<form [formGroup]="form" (ngSubmit)="onSubmit()" class="article-form">
		<div class="form-group">
			<label for="slug">Slug (URL-friendly, ex: mon-article-1)</label>
			<input id="slug" type="text" formControlName="slug" placeholder="oqtf-erreurs-eviter" />
			@if (form.get('slug')?.invalid && form.get('slug')?.touched) {
			<span class="error">Le slug doit contenir uniquement des lettres, chiffres et tirets</span>
			}
		</div>

		<div class="form-group">
			<label for="title">Titre</label>
			<input id="title" type="text" formControlName="title" placeholder="Titre de l'article" />
		</div>

		<div class="form-group">
			<label for="summary">Résumé</label>
			<textarea
				id="summary"
				formControlName="summary"
				placeholder="Résumé court de l'article"
				rows="3"
			></textarea>
		</div>

		<div class="form-group">
			<label for="category">Catégorie</label>
			<select id="category" formControlName="category">
				<option value="Conseils Juridiques">Conseils Juridiques</option>
				<option value="Procédures">Procédures</option>
				<option value="Recours">Recours</option>
				<option value="Actualités">Actualités</option>
			</select>
		</div>

		<div class="form-group">
			<label for="date">Date</label>
			<input id="date" type="date" formControlName="date" />
		</div>

		<div class="form-group">
			<label for="markdown-upload">Fichier Markdown</label>
			<input id="markdown-upload" type="file" accept=".md" (change)="onMarkdownFileSelected($event)" />
			@if (markdownFile()) {
			<span class="file-name">{{ markdownFile()!.name }}</span>
			}
		</div>

		<div class="form-group">
			<label for="similar-slugs">Articles similaires (slugs séparés par des virgules)</label>
			<input
				id="similar-slugs"
				type="text"
				formControlName="similarSlugs"
				placeholder="oqtf-erreurs-eviter, autre-article"
			/>
		</div>

		<button type="submit" [disabled]="form.invalid || saving()" class="btn btn-success">
			{{ saving() ? 'Création en cours...' : 'Créer l\'article' }}
		</button>
	</form>
	}

	<div class="articles-list">
		<h2>Articles existants ({{ articles().length }})</h2>
		@if (loading()) {
		<p>Chargement des articles...</p>
		} @else if (articles().length === 0) {
		<p>Aucun article trouvé</p>
		} @else {
		<div class="articles-grid">
			@for (article of articles(); track article.slug) {
			<div class="article-card">
				<div class="article-info">
					<h3>{{ article.title }}</h3>
					<p class="slug"><strong>Slug:</strong> {{ article.slug }}</p>
					<p class="category"><strong>Catégorie:</strong> {{ article.category }}</p>
					<p class="date"><strong>Date:</strong> {{ article.date }}</p>
					<p class="file"><strong>Fichier:</strong> {{ article.markdownFile }}</p>
					@if (article.similarSlugs.length > 0) {
					<p class="similar"><strong>Articles similaires:</strong> {{ article.similarSlugs.join(', ') }}</p>
					}
				</div>
				<button (click)="deleteArticle(article.slug)" [disabled]="saving()" class="btn btn-danger btn-small">
					Supprimer
				</button>
			</div>
			}
		</div>
		}
	</div>
</div>
