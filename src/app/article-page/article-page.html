<main class="container blog-page">
	<button mat-button (click)="goBack()" aria-label="Revenir à la page précédente" class="back-button">
		<mat-icon>arrow_back</mat-icon><span i18n="Blog page|Back to blog link">Retour</span>
	</button>
	@if (loading()) {
	<article class="blog-post article-skeleton" aria-busy="true">
		@for (i of [1, 2, 3, 4, 5]; track i) {
		<div class="skeleton-title"></div>
		<div class="skeleton-summary"></div>
		<div class="skeleton-line"></div>
		<div class="skeleton-line"></div>
		<div class="skeleton-line"></div>
		<div class="skeleton-line"></div>
		<div class="skeleton-line"></div>
		<div class="skeleton-title"></div>
		<div class="skeleton-line short"></div>
		}
	</article>
	} @else if (article(); as art) {
	<article class="blog-post" itemscope itemtype="https://schema.org/BlogPosting">
		<h1 #headline class="mat-display-2" itemprop="headline">{{ art.title || 'Article non trouvé' }}</h1>
		<p class="mat-headline-5" itemprop="description">{{ art.summary || 'Aucun résumé disponible' }}</p>

		<div class="article-actions-row">
			<!-- Mobile: simple icon opens bottom sheet -->
			<button mat-icon-button aria-label="Actions mobile" (click)="openArticleActions()" class="mobile-only">
				<mat-icon>more_vert</mat-icon>
			</button>

			<!-- Desktop: menu with actions -->
			<div class="desktop-only">
				<button
					mat-icon-button
					[matMenuTriggerFor]="actionsMenu"
					aria-label="Actions"
					(click)="onActionsClick($event)"
				>
					<mat-icon>more_vert</mat-icon>
				</button>
				<mat-menu #actionsMenu="matMenu">
					<button mat-menu-item (click)="shareArticle()">
						<mat-icon>share</mat-icon><span>Partager</span>
					</button>
					<button mat-menu-item (click)="copyArticleLink()">
						<mat-icon>link</mat-icon><span>Copier le lien</span>
					</button>
					<button mat-menu-item (click)="saveArticle()">
						<mat-icon>{{ isSaved() ? 'bookmark' : 'bookmark_border' }}</mat-icon
						><span>{{ isSaved() ? 'Supprimer' : 'Enregistrer' }}</span>
					</button>
					<mat-divider></mat-divider>
					<button mat-menu-item disabled *ngIf="art.readingTime">
						<mat-icon>schedule</mat-icon><span>{{ getReadingTimeText(art.readingTime) }}</span>
					</button>
				</mat-menu>
			</div>
		</div>

		@if (art.readingTime) {
		<div class="article-meta">
			<span class="reading-time-badge">
				<mat-icon>schedule</mat-icon>
				{{ getReadingTimeText(art.readingTime) }}
			</span>
			@if (art.date) {
			<span class="article-date">
				<time [attr.datetime]="art.date" itemprop="datePublished">{{ art.date }}</time>
			</span>
			}
		</div>
		}

		<div
			animate.enter="enter-slide-fade-animation"
			[innerHTML]="art.content"
			class="blog-content"
			itemprop="articleBody"
		></div>

		@if (art.author) {
		<aside class="author-bio-section" itemprop="author" itemscope itemtype="https://schema.org/Person">
			<div class="author-bio-container">
				@if (art.author.image) {
				<img [src]="art.author.image" [alt]="art.author.name" class="author-image" itemprop="image" />
				} @else {
				<div class="author-avatar">
					<mat-icon>account_circle</mat-icon>
				</div>
				}
				<div class="author-info">
					<h3 class="author-name" itemprop="name">{{ art.author.name }}</h3>
					<p class="author-title" itemprop="jobTitle">{{ art.author.title }}</p>
					<p class="author-bio" itemprop="description">{{ art.author.bio }}</p>
				</div>
			</div>
		</aside>
		}
	</article>
	@if (similarArticles().length > 0) {
	<section class="similar-articles" aria-label="Articles similaires">
		<h2 class="similar-title" i18n="Blog page|Similar articles heading">Articles similaires</h2>
		<div class="similar-grid" animateText="fade">
			@for (similar of similarArticles(); track similar.slug) {
			<app-blog-article-card [article]="similar"></app-blog-article-card>
			}
		</div>
	</section>
	} } @else {
	<p class="mat-body-1" i18n="Blog page|Article not found error">Article introuvable</p>
	}
</main>
