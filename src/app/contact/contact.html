<main class="container contact-page" animate.enter="enter-fade-animation">
	@if (isSubmitting()) {
	<div class="submission-overlay" role="alert" aria-live="polite">
		<mat-spinner diameter="64"></mat-spinner>
		<p class="submission-overlay__text" i18n="Contact page|Submission overlay text">Envoi en cours...</p>
	</div>
	}
	<header class="page-header">
		<h1 class="mat-display-2" i18n="Contact page|Page title">Contactez-nous</h1>
		<p class="mat-headline-5" i18n="Contact page|Page subtitle">
			Vous avez des questions sur vos droits ou besoin d'une consultation ? N'hésitez pas à nous contacter. Nous
			vous répondrons dans les plus brefs délais.
		</p>
	</header>

	<div class="contact-content">
		<!-- Informations de contact -->
		<section class="contact-info">
			<mat-card class="info-card" animateText="fade">
				<mat-card-header>
					<mat-icon mat-card-avatar>phone</mat-icon>
					<mat-card-title i18n="Contact page|Phone card title">Téléphone</mat-card-title>
				</mat-card-header>
				<mat-card-content>
					<p i18n="Contact page|Phone number">{{ config.phone }}</p>

					<p class="subtitle" i18n="Contact page|Phone hours">
						Du lundi au vendredi, {{ config.hours.weekday.open.slice(0, 5) }}-{{
						config.hours.weekday.close.slice(0, 5) }}
					</p>
					<a mat-flat-button [href]="'tel:+33' + config.phone.replace(/\\s/g, '')">
						<mat-icon>phone</mat-icon>
						<span i18n="Contact page|Call button">Appeler</span>
					</a>
				</mat-card-content>
			</mat-card>

			<mat-card
				animateText="fade"
				class="info-card"
				(click)="copyToClipboard(config.email, 'contact.email.copied')"
			>
				<mat-card-header>
					<mat-icon mat-card-avatar>email</mat-icon>
					<mat-card-title i18n="Contact page|Email card title">Email</mat-card-title>
				</mat-card-header>
				<mat-card-content>
					<div
						class="copy-row"
						i18n-aria-label="Contact page|Email address card"
						aria-label="Adresse e-mail du cabinet"
					>
						<p class="copy-text" i18n="Contact page|Email address">{{ config.email }}</p>
						<button
							mat-icon-button
							class="copy-btn"
							i18n-aria-label="Contact page|Copy email button"
							aria-label="Copier l'e-mail"
						>
							<mat-icon>content_copy</mat-icon>
						</button>
					</div>
					<p class="subtitle" i18n="Contact page|Email response time">
						Réponse sous {{ config.responseTime.email }}
					</p>
					<a
						mat-flat-button
						[href]="'mailto:' + config.email + '?subject=Demande%20de%20consultation%20juridique&body=Bonjour%20Ma%C3%AEtre%20Martinet%2C%0A%0AJe%20vous%20contacte%20au%20sujet%20de%20%3A%0A%0ANom%20%3A%20%0APr%C3%A9nom%20%3A%20%0AT%C3%A9l%C3%A9phone%20%3A%20%0A%0AObjet%20de%20la%20demande%20%3A%0A%0A%0ACordialement%2C'"
					>
						<mat-icon>email</mat-icon>
						<span i18n="Contact page|Send email button">Envoyer un e-mail</span>
					</a>
				</mat-card-content>
			</mat-card>

			<mat-card class="info-card" animateText="fade">
				<mat-card-header>
					<mat-icon mat-card-avatar>schedule</mat-icon>
					<mat-card-title i18n="Contact page|Hours card title">Horaires d'ouverture</mat-card-title>
				</mat-card-header>
				<mat-card-content>
					<ul
						class="hours-list"
						i18n-aria-label="Contact page|Hours list"
						aria-label="Horaires d'ouverture du cabinet"
					>
						<li
							class="hours-item open"
							i18n-aria-label="Contact page|Weekdays hours"
							aria-label="Ouvert du lundi au vendredi de 9h à 18h"
						>
							<mat-icon aria-hidden="true">check_circle</mat-icon>
							<span class="day" i18n="Contact page|Weekdays label">Lundi – Vendredi</span>
							<span class="time"
								>{{ config.hours.weekday.open.slice(0, 5) }} – {{ config.hours.weekday.close.slice(0, 5)
								}}</span
							>
						</li>
						<li
							class="hours-item appointment"
							i18n-aria-label="Contact page|Saturday hours"
							aria-label="Samedi sur rendez-vous"
						>
							<mat-icon aria-hidden="true">event_available</mat-icon>
							<span class="day" i18n="Contact page|Saturday label">Samedi</span>
							<span class="note" i18n="Contact page|Saturday note">Sur rendez-vous</span>
						</li>
						<li
							class="hours-item closed"
							i18n-aria-label="Contact page|Sunday hours"
							aria-label="Dimanche fermé"
						>
							<mat-icon aria-hidden="true">cancel</mat-icon>
							<span class="day" i18n="Contact page|Sunday label">Dimanche</span>
							<span class="note" i18n="Contact page|Sunday note">Fermé</span>
						</li>
					</ul>
				</mat-card-content>
			</mat-card>

			<mat-card
				animateText="fade"
				class="info-card"
				(click)="copyToClipboard(config.address.full, 'contact.address.copied')"
			>
				<mat-card-header>
					<mat-icon mat-card-avatar>location_on</mat-icon>
					<mat-card-title i18n="Contact page|Address card title">Adresse</mat-card-title>
				</mat-card-header>
				<mat-card-content>
					<div class="copy-row" i18n-aria-label="Contact page|Address card" aria-label="Adresse du cabinet">
						<p class="copy-text" i18n="Contact page|Address lines">
							{{ config.address.street }}<br />{{ config.address.city }}
						</p>
						<button
							mat-icon-button
							class="copy-btn"
							i18n-aria-label="Contact page|Copy address button"
							aria-label="Copier l'adresse"
						>
							<mat-icon>content_copy</mat-icon>
						</button>
					</div>
					<div class="map-container">
						@if (iframeLoading()) {
						<div class="iframe-loader">
							<mat-spinner diameter="60"></mat-spinner>
							<p>Chargement de la carte...</p>
						</div>
						}
						<iframe
							[src]="safeMapUrl"
							width="100%"
							height="200"
							style="border: 0; border-radius: 8px; margin-top: 1rem"
							sandbox="allow-scripts allow-same-origin"
							allowfullscreen="true"
							loading="lazy"
							referrerpolicy="no-referrer-when-downgrade"
							title="Carte de l'adresse du cabinet"
							i18n-title="Contact page|Map title"
							(load)="onIframeLoad()"
							[style.display]="iframeLoading() ? 'none' : 'block'"
						></iframe>
					</div>
				</mat-card-content>
			</mat-card>
		</section>

		<!-- Formulaire de contact -->
		<section class="contact-form">
			<mat-card>
				<mat-card-header>
					<mat-card-title i18n="Contact page|Form title">Envoyez-nous un message</mat-card-title>
					<mat-card-subtitle i18n="Contact page|Form subtitle"
						>Remplissez le formulaire ci-dessous</mat-card-subtitle
					>
				</mat-card-header>
				<mat-card-content>
					<form [formGroup]="contactForm" (ngSubmit)="onSubmit()" class="contact-form-fields">
						<mat-form-field animateText="fade" appearance="outline" class="full-width">
							<mat-label i18n="Contact page|Name label">Nom complet</mat-label>
							<input
								matInput
								formControlName="name"
								required
								aria-label="Nom complet - Champ obligatoire"
								aria-required="true"
								minlength="2"
								maxlength="100"
							/>
							@if (contactForm.get('name')?.invalid && contactForm.get('name')?.touched) { @if
							(contactForm.get('name')?.errors?.['required']) {
							<mat-error i18n="Contact page|Name error required">Le nom est requis</mat-error>
							} @if (contactForm.get('name')?.errors?.['minlength']) {
							<mat-error i18n="Contact page|Name error minlength"
								>Le nom doit contenir au moins 2 caractères</mat-error
							>
							} @if (contactForm.get('name')?.errors?.['maxlength']) {
							<mat-error i18n="Contact page|Name error maxlength"
								>Le nom ne peut pas dépasser 100 caractères</mat-error
							>
							} } @if (contactForm.get('name')?.valid && contactForm.get('name')?.touched) {
							<mat-hint class="success-hint" i18n="Contact page|Name success">✓ Nom valide</mat-hint>
							}
						</mat-form-field>

						<mat-form-field animateText="fade" appearance="outline" class="full-width">
							<mat-label i18n="Contact page|Email label">Email</mat-label>
							<input
								matInput
								type="email"
								formControlName="email"
								required
								aria-label="Adresse email - Champ obligatoire"
								aria-required="true"
							/>
							@if (contactForm.get('email')?.invalid && contactForm.get('email')?.touched) { @if
							(contactForm.get('email')?.errors?.['required']) {
							<mat-error i18n="Contact page|Email error required">L'email est requis</mat-error>
							} @if (contactForm.get('email')?.errors?.['email']) {
							<mat-error i18n="Contact page|Email error format"
								>Veuillez entrer un email valide</mat-error
							>
							} } @if (contactForm.get('email')?.valid && contactForm.get('email')?.touched) {
							<mat-hint class="success-hint" i18n="Contact page|Email success">✓ Email valide</mat-hint>
							}
							<mat-hint i18n="Contact page|Email hint">Exemple: contact@example.com</mat-hint>
						</mat-form-field>

						<mat-form-field animateText="fade" appearance="outline" class="full-width">
							<mat-label i18n="Contact page|Phone label">Téléphone</mat-label>
							<input
								matInput
								formControlName="phone"
								aria-label="Numéro de téléphone - Champ facultatif"
								placeholder="+33 X XX XX XX XX"
								i18n-placeholder="Contact page|Phone placeholder"
							/>
							@if (contactForm.get('phone')?.valid && contactForm.get('phone')?.touched &&
							contactForm.get('phone')?.value) {
							<mat-hint class="success-hint" i18n="Contact page|Phone success"
								>✓ Téléphone reconnu</mat-hint
							>
							}
						</mat-form-field>

						<mat-form-field animateText="fade" appearance="outline" class="full-width">
							<mat-label i18n="Contact page|Subject label">Sujet</mat-label>
							<mat-select
								formControlName="subject"
								required
								aria-label="Sujet du message - Champ obligatoire"
								aria-required="true"
							>
								<mat-option value="consultation" i18n="Contact page|Consultation option"
									>Demande de consultation</mat-option
								>
								<mat-option value="information" i18n="Contact page|Information option"
									>Demande d'information</mat-option
								>
								<mat-option value="urgence" i18n="Contact page|Urgency option"
									>Urgence juridique</mat-option
								>
								<mat-option value="autre" i18n="Contact page|Other option">Autre</mat-option>
							</mat-select>
							@if (contactForm.get('subject')?.invalid && contactForm.get('subject')?.touched) {
							<mat-error i18n="Contact page|Subject error">Veuillez sélectionner un sujet</mat-error>
							} @if (contactForm.get('subject')?.valid && contactForm.get('subject')?.touched) {
							<mat-hint class="success-hint" i18n="Contact page|Subject success"
								>✓ Sujet sélectionné</mat-hint
							>
							}
						</mat-form-field>

						<mat-form-field
							animateText="fade"
							floatLabel="always"
							appearance="outline"
							class="full-width message-field-wrapper"
						>
							<mat-label i18n="Contact page|Message label">Message</mat-label>
							<textarea
								matInput
								formControlName="message"
								rows="7"
								maxlength="1000"
								required
								minlength="20"
								spellcheck="true"
								class="message-textarea"
								placeholder="Décrivez votre situation juridique, votre demande (titre de séjour, naturalisation, etc.) et vos besoins..."
								i18n-placeholder="Contact page|Message placeholder"
								aria-label="Message du formulaire de contact - Champ obligatoire (1000 caractères maximum)"
								aria-required="true"
								aria-describedby="message-hint message-count"
							></textarea>
							@if (speechSupported()) {
							<button
								mat-icon-button
								type="button"
								class="voice-input-button"
								[class.listening]="isListening()"
								(click)="startVoiceInput()"
								matSuffix
								i18n-title="Contact page|Voice input button"
								title="Utiliser la reconnaissance vocale"
							>
								<mat-icon>{{ isListening() ? 'mic' : 'mic_none' }}</mat-icon>
							</button>
							} @if (contactForm.get('message')?.invalid && contactForm.get('message')?.touched) { @if
							(contactForm.get('message')?.errors?.['required']) {
							<mat-error i18n="Contact page|Message error required">Le message est requis</mat-error>
							} @if (contactForm.get('message')?.errors?.['minlength']) {
							<mat-error i18n="Contact page|Message error minlength"
								>Le message doit contenir au moins 20 caractères</mat-error
							>
							} } @if (contactForm.get('message')?.valid && contactForm.get('message')?.touched) {
							<mat-hint class="success-hint" i18n="Contact page|Message success"
								>✓ Message complet</mat-hint
							>
							}
							<mat-hint
								id="message-count"
								[class.warning]="(contactForm.get('message')?.value?.length || 0) > 900"
							>
								{{ contactForm.get('message')?.value?.length || 0 }}/1000
								<span i18n="Contact page|Character count">caractères</span>
								@if ((contactForm.get('message')?.value?.length || 0) > 900) {
								<span class="warning-text" i18n="Contact page|Character limit warning">
									- Approche de la limite</span
								>
								}
							</mat-hint>
						</mat-form-field>
						<mat-hint id="message-hint" i18n="Contact page|Message hint">
							Soyez précis pour nous aider à mieux comprendre votre situation
						</mat-hint>

						<div class="form-actions">
							<button
								matFab
								extended
								type="submit"
								[disabled]="contactForm.invalid || isSubmitting()"
								[attr.aria-busy]="isSubmitting()"
								[attr.aria-label]="isSubmitting()
									? 'Message en cours d\'envoi'
									: 'Envoyer le message du formulaire de contact'"
							>
								<mat-icon>{{ isSubmitting() ? 'hourglass_empty' : 'send' }}</mat-icon>
								@if (!isSubmitting()) {
								<span i18n="Contact page|Submit button">Envoyer le message</span>
								} @else {
								<span i18n="Contact page|Submitting">Envoi en cours...</span>
								}
							</button>
						</div>
					</form>
				</mat-card-content>
			</mat-card>
		</section>
	</div>

	<!-- Section CTA -->
	<section class="cta-section text-center" animateText="fade">
		<h2 class="mat-headline-4" i18n="Contact page|CTA title">Besoin d'une consultation urgente ?</h2>
		<p i18n="Contact page|CTA description">
			Contactez-nous directement par téléphone pour une prise en charge rapide.
		</p>
		<a mat-flat-button [href]="'tel:+33' + config.phone.replace(/\s/g, '')">
			<mat-icon>phone</mat-icon>
			<span i18n="Contact page|CTA button">Appeler maintenant</span>
		</a>
	</section>
</main>
